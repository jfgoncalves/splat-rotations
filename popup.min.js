function init(){var e,t;e=localStorage.getItem("region"),t="https://splatoon.ink/schedule.json","jp"==e&&(t="http://s3-ap-northeast-1.amazonaws.com/splatoon-data.nintendo.net/fes_info.json"),retrieveFes(t,e)}function retrieveFes(e,t){var n,a,s;n=new XMLHttpRequest,a=(new Date).getTime(),n.open("GET",e+"?c="+a,!0),n.setRequestHeader("Content-type","application/json"),n.onreadystatechange=function(){4==n.readyState&&200==n.status?(s=JSON.parse(n.responseText),1==s.fes_state?parseFes(s,t):"https://splatoon.ink/schedule.json"==e?parseRotations(s):retrieveRotations()):3==n.readyState?document.getElementById("load").innerHTML=chrome.i18n.getMessage("loading"):(403==n.status,document.getElementById("load").innerHTML=chrome.i18n.getMessage("error"))},n.send(null)}function retrieveRotations(){var e,t,n;e=new XMLHttpRequest,t=(new Date).getTime(),e.open("GET","https://splatoon.ink/schedule.json?c="+t,!0),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){4==e.readyState&&200==e.status?(n=JSON.parse(e.responseText),parseRotations(n)):(403==e.status,document.getElementById("load").innerHTML=chrome.i18n.getMessage("error"))},e.send(null)}function parseFes(e,t){var n,a,s;if(document.getElementById("day").id="night",document.getElementById("rotations").innerHTML="",n=document.createElement("link"),n.rel="stylesheet",n.href="popup_night.min.css",document.getElementsByTagName("head")[0].appendChild(n),a=document.createElement("img"),a.className="fesTitle",a.src="assets/fes.png",document.getElementById("rotations").appendChild(a),s=document.createElement("div"),s.className="title",s.innerHTML=chrome.i18n.getMessage("fesTitle"),document.getElementById("rotations").appendChild(s),"jp"==t){var r,o,m,i,d,c,l;r=e.fes_stages,c=document.createElement("div");for(l in r)r.hasOwnProperty(l)&&(o=document.createElement("div"),o.className="fesContainer",d=jpNameParser(r[l].name),m=document.createElement("img"),m.className="map",m.src="assets/stages/night/"+d+".jpg",o.appendChild(m),m.onerror=function(){this.onerror=null,this.src="assets/stages/notfoundfes.jpg"},i=document.createElement("div"),i.className="name",i.innerHTML=chrome.i18n.getMessage(d),o.appendChild(i),c.appendChild(o));document.getElementById("rotations").appendChild(c)}}function jpNameParser(e){var t={"アロワナモール":"arowana","Ｂバスパーク":"blackbelly","ネギトロ炭鉱":"bluefin","モンガラキャンプ場":"camp","ヒラメが丘団地":"flounder","マサバ海峡大橋":"hammerhead","モズク農園":"kelp","タチウオパーキング":"moray","キンメダイ美術館":"museum","ホッケふ頭":"port","シオノメ油田":"saltspray","デカライン高架下":"urchin","ハコフグ倉庫":"walleye","マヒマヒリゾート＆スパ":"mahi","ガチエリア":"splat","ガチホコ":"rainmaker","ガチヤグラ":"tower"};return t[e]}function parseRotations(e){var t,n,a,s,r,o,m,i,d,c,l,p,g,u,h,E,f,N,M,y,j,v,T;t=e.schedule,document.getElementById("rotations").innerHTML="";for(n in t)if(t.hasOwnProperty(n)){a=new Date(t[n].startTime),r=t[n].regular.maps,o=t[n].ranked.maps,m=t[n].ranked.rulesJP,s=0===Number([n])?chrome.i18n.getMessage("currentRotation"):"12"===localStorage.getItem("timeFormat")?chrome.i18n.getMessage("nextRotation")+a.toLocaleTimeString("en-US").replace(":00 "," "):chrome.i18n.getMessage("nextRotation")+a.toLocaleTimeString("fr-FR").replace(":00:00","h00"),i=document.createElement("div"),i.id=[n],d=document.createElement("div"),d.className="time rotation"+[n],d.innerHTML=s,i.appendChild(d),c=document.createElement("div"),c.className="regular",i.appendChild(c),l=document.createElement("img"),l.className="imgMode",l.src="assets/modes/regular.png",c.appendChild(l),p=document.createElement("div"),p.className="ranked",i.appendChild(p),g=document.createElement("img"),g.className="imgMode",g.src="assets/modes/ranked.png",p.appendChild(g),u=document.createElement("div"),u.className="mode "+jpNameParser(m),u.innerHTML=chrome.i18n.getMessage(jpNameParser(m)),p.appendChild(u);for(h in r)r.hasOwnProperty(h)&&(E=r[h].nameJP,f=document.createElement("div"),f.className="map"+[h],N=document.createElement("img"),N.className="map","notInked"===localStorage.getItem("setInk")?N.src="assets/stages/alpha/"+jpNameParser(E)+".jpg":N.src="assets/stages/day/"+jpNameParser(E)+".jpg",N.onerror=function(){this.onerror=null,this.src="assets/stages/notfound.jpg"},f.appendChild(N),M=document.createElement("div"),M.className="name",void 0===jpNameParser(E)?M.innerHTML=chrome.i18n.getMessage("unknown"):M.innerHTML=chrome.i18n.getMessage(jpNameParser(E)),f.appendChild(M),c.appendChild(f));for(h in o)o.hasOwnProperty(h)&&(E=o[h].nameJP,y=document.createElement("div"),y.className="map"+[h],j=document.createElement("img"),j.className="map","notInked"===localStorage.getItem("setInk")?j.src="assets/stages/alpha/"+jpNameParser(E)+".jpg":j.src="assets/stages/day/"+jpNameParser(E)+".jpg",j.onerror=function(){this.onerror=null,this.src="assets/stages/notfound.jpg"},y.appendChild(j),v=document.createElement("div"),v.className="name",void 0===jpNameParser(E)?v.innerHTML=chrome.i18n.getMessage("unknown"):v.innerHTML=chrome.i18n.getMessage(jpNameParser(E)),y.appendChild(v),p.appendChild(y));T=document.createElement("hr"),i.appendChild(T),document.getElementById("rotations").appendChild(i)}}document.getElementById("load").innerHTML=chrome.i18n.getMessage("loading"),init();